<?xml version="1.0"?>

<Configuration status="${log4j2.configuration.status}">

	<Appenders>
		<!-- The accesslog (logs usermovements) -->
		<RollingFile name="ACCESS"
		             fileName="${com.imcode.imcms.path}/WEB-INF/logs/access.log"
		             filePattern="${com.imcode.imcms.path}/WEB-INF/logs/access-%d{yyyy-MM}.log"
		             ignoreExceptions="false">
			<PatternLayout charset="UTF-8" pattern="%d{ISO8601} %m%n"/>
			<Policies>
				<TimeBasedTriggeringPolicy interval="1" modulate="true"/>
			</Policies>
		</RollingFile>

		<!-- The mainlog (captures edits and changes) -->
		<RollingFile name="MAIN"
		             fileName="${com.imcode.imcms.path}/WEB-INF/logs/main.log"
		             filePattern="${com.imcode.imcms.path}/WEB-INF/logs/main-%d{yyyy-MM}.log"
		             ignoreExceptions="false">
			<PatternLayout charset="UTF-8" pattern="%d{ISO8601} %-5p %m%n"/>
			<Policies>
				<TimeBasedTriggeringPolicy interval="1" modulate="true"/>
			</Policies>
		</RollingFile>

		<!-- The errorlog (captures everything that doesn't go to one of the above. -->
		<RollingFile name="ERROR"
		             fileName="${com.imcode.imcms.path}/WEB-INF/logs/error.log"
		             filePattern="${com.imcode.imcms.path}/WEB-INF/logs/error-%d{yyyy-MM}.log"
		             ignoreExceptions="false">
			<PatternLayout charset="UTF-8" pattern="%d{ISO8601} %-5p %c - %m%n"/>
			<Policies>
				<TimeBasedTriggeringPolicy interval="1" modulate="true"/>
			</Policies>
		</RollingFile>

		<!-- The alllog (captures everything that doesn't go to one of the above. -->
		<RollingFile name="ALL"
		             fileName="${com.imcode.imcms.path}/WEB-INF/logs/all.log"
		             filePattern="${com.imcode.imcms.path}/WEB-INF/logs/all-%d{yyyy-MM}.log"
		             ignoreExceptions="false">
			<PatternLayout charset="UTF-8" pattern="%d{ISO8601} %-5p %c - %m%n"/>
			<Policies>
				<TimeBasedTriggeringPolicy interval="1" modulate="true"/>
			</Policies>
		</RollingFile>

		<Console name="CONSOLE" target="SYSTEM_OUT">
			<PatternLayout pattern="%d{ISO8601} %-5p %c - %m%n" charset="UTF-8"/>
		</Console>
	</Appenders>
	<Loggers>
		<!-- Set up accesslog with priority 'info' -->
		<Logger name="com.imcode.imcms.log.access" level="info" additivity="false">
			<AppenderRef ref="ACCESS"/>
		</Logger>

		<!-- Set up mainlog with priority 'info' -->
		<Logger name="com.imcode.imcms.log.main" level="info" additivity="false">
			<AppenderRef ref="MAIN"/>
		</Logger>

		<Logger name="org.apache" level="error" additivity="false">
			<AppenderRef ref="ERROR"/>
		</Logger>

		<!--Log all SQL DML statements as they are executed-->
		<Logger name="org.hibernate.SQL" level="${log4j2.hibernate.level}" additivity="false">
			<AppenderRef ref="ALL"/>
		</Logger>

		<!--Log all JDBC parameters-->
		<Logger name="org.hibernate.type" level="${log4j2.hibernate.level}" additivity="false">
			<AppenderRef ref="ALL"/>
		</Logger>

		<!--Log transaction related activity-->
		<Logger name="org.hibernate.transaction" level="${log4j2.hibernate.level}" additivity="false">
			<AppenderRef ref="ALL"/>
		</Logger>

		<!--DISABLED-->
		<!--Log all SQL DDL statements as they are executed-->
		<Logger name="org.hibernate.tool.hbm2ddl" level="OFF" additivity="false">
			<AppenderRef ref="ALL"/>
		</Logger>

		<!--Log the state of all entities (max 20 entities) associated with the session at flush time-->
		<Logger name="org.hibernate.pretty" level="OFF" additivity="false">
			<AppenderRef ref="ALL"/>
		</Logger>

		<!--Log all second-level cache activity-->
		<Logger name="org.hibernate.cache" level="OFF" additivity="false">
			<AppenderRef ref="ALL"/>
		</Logger>

		<!--Log all JDBC resource acquisition-->
		<Logger name="org.hibernate.jdbc" level="OFF" additivity="false">
			<AppenderRef ref="ALL"/>
		</Logger>

		<!--Log HQL and SQL ASTs during query parsing-->
		<Logger name="org.hibernate.hql.ast.AST" level="OFF" additivity="false">
			<AppenderRef ref="ALL"/>
		</Logger>

		<!--Log all JAAS authorization requests-->
		<Logger name="org.hibernate.secure" level="OFF" additivity="false">
			<AppenderRef ref="ALL"/>
		</Logger>

		<!--Log everything (a lot of information, but very useful for troubleshooting)-->
		<Logger name="org.hibernate" level="OFF" additivity="false">
			<AppenderRef ref="ALL"/>
		</Logger>

		<Root level="${log4j2.root.level}">
			<AppenderRef ref="ALL"/>
			<AppenderRef ref="ERROR"/>
			<AppenderRef ref="CONSOLE" level="${log4j2.console-appender.level}"/>
		</Root>
	</Loggers>
</Configuration>